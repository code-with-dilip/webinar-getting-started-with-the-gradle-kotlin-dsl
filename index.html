<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>: Getting started with the Gradle Kotlin DSL</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js/css/theme/gradle.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" /><link href="github" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js/css/print/pdf.css" : "reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js/lib/js/html5shiv.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-player.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-theme-gradle.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/github-gist.css" />
<script src="reveal.js/css/theme/asciinema-player.js"></script></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title" data-transition="zoom" data-transition-speed="fast" data-background-image="./images/title.jpeg"><h1></h1><h2>Getting started with the Gradle Kotlin DSL</h2><div class="preamble"><div class="paragraph"><p>Paul Merlin (@eskat0s) &amp; Rodrigo B. de Oliveira (@rodrigobamboo) - Gradle Inc.</p></div></div></section>
<section id="who-are-we"><h2>Who are we?</h2><div class="imageblock" style=""><img src="./images/who-s-who.png" alt="who s who" width="586" height="250" /></div>
<div class="paragraph"><p>Gradle Kotlin DSL Team</p></div></section>
<section id="who-are-you"><h2>Who are you?</h2><div class="ulist"><ul><li><p>How are you using Gradle?</p></li><li><p>What is your primary programming language?</p></li></ul></div></section>
<section><section id="what-is-gradle" data-background-color="#01303a"><h2>What is Gradle?</h2></section><section id="gradle-s-purpose"><h2>Gradle&#8217;s purpose</h2><div class="paragraph"><p>Gradle is a build and automation tool.</p></div>
<div class="ulist"><ul><li><p>JVM based</p></li><li><p>Implemented in Java</p></li><li><p>100% Free Open Source - Apache Standard License 2.0</p></li></ul></div></section><section id="agnostic-build-system"><h2>Agnostic Build System</h2><div class="ulist"><ul><li><p>Java ecosystem</p><div class="ulist"><ul><li><p>Groovy, Kotlin, Scala, &#8230;&#8203;</p></li></ul></div></li><li><p>Native ecosystem</p><div class="ulist"><ul><li><p>C, C++, Swift, &#8230;&#8203;</p></li></ul></div></li><li><p>Android</p></li><li><p>Misc</p><div class="ulist"><ul><li><p>Python, Go, Asciidoctor, &#8230;&#8203;</p></li></ul></div></li></ul></div></section><section id="gradle-enterprise"><h2>Gradle Enterprise</h2><div class="imageblock" style=""><img src="./images/gradle-enterprise.png" alt="gradle enterprise" width="80%" height="80%" /></div></section></section>
<section id="what-type-of-application-are-you-building" data-background-color="#01303a"><h2>What type of application are you building?</h2></section>
<section id="agenda" data-background-color="#01303a"><h2>Agenda</h2><div class="ulist"><ul><li><p>Creating a Gradle Kotlin DSL build</p></li><li><p>Customizing the build</p></li><li><p>Organizing build logic</p></li><li><p>Authoring plugins and DSLs</p></li></ul></div></section>
<section><section id="introduction" data-background-color="#01303a"><h2>Introduction</h2></section><section id="gradle-the-basics"><h2>Gradle, the basics</h2><div class="ulist"><ul><li class="fragment"><p>Automate execution of configurable tasks</p></li><li class="fragment"><p>Groovy and Kotlin build scripts</p></li><li class="fragment"><p>A Java API with a Kotlin and Groovy DSL on top</p></li><li class="fragment"><p>Work avoidance, dependency management etc&#8230;&#8203;</p></li><li class="fragment"><p>Reusable functionality packaged as plugins</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/gradle-task-dag.png" alt="gradle task dag" width="1280" height="350px" /></div></section><section id="a-java-library"><h2>A Java library</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
   `java-library`
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

dependencies {
   api("com.acme:foo:1.0")
   implementation("com.zoo:monkey:1.1")
}</code></pre></section><section id="a-native-app"><h2>A native app</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
    `cpp-application`
}

application {
    baseName = "my-app"
}

toolChains {
    // ...
}</code></pre></section></section>
<section><section id="creating-a-gradle-kotlin-dsl-build" data-background-color="#01303a"><h2>Creating a Gradle Kotlin DSL build</h2></section><section id="creating-a-gradle-kotlin-dsl-build-2"><h2>Creating a Gradle Kotlin DSL build</h2><div class="ulist"><ul><li><p>With Gradle locally installed</p></li><li><p><code>gradle init</code></p></li></ul></div></section><section id="gradle-init" data-background-color="#000000" data-background-size="contain" data-background-video="images/movies/gradle-init.mp4" data-background-video-loop="" data-background-video-muted=""><aside class="notes"><div class="ulist"><ul><li><p><code>init</code> gives several templates to choose from</p></li><li><p>here we choose a Kotlin application using the Gradle Kotlin DSL</p></li></ul></div></aside></section><section id="creating-a-gradle-kotlin-dsl-build-3"><h2>Creating a Gradle Kotlin DSL build</h2><div class="ulist"><ul><li><p>Without Gradle locally installed</p></li><li><p>From a Web UI</p></li><li><p><a href="https://gradle-initializr.cleverapps.io/" class="bare">https://gradle-initializr.cleverapps.io/</a></p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>the same can be done without having Gradle installed</p></li><li><p>by <a href="https://gradle-initializr.cleverapps.io/" class="bare">https://gradle-initializr.cleverapps.io/</a></p></li></ul></div></aside></section><section id="gradle-initializr" data-background-color="#000000" data-background-size="contain" data-background-video="images/movies/gradle-initializr.mp4" data-background-video-loop="" data-background-video-muted=""><aside class="notes"><div class="ulist"><ul><li><p>which basically drives <code>gradle init</code></p></li><li><p>and again we choose a Kotlin application using the Gradle Kotlin DSL with latest Gradle</p></li></ul></div></aside></section><section id="creating-a-gradle-kotlin-dsl-build-4"><h2>Creating a Gradle Kotlin DSL build</h2><div class="paragraph"><p>One-liner without Gradle installed</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="text language-text">➜ mkdir webinar-app \
    &amp;&amp; cd webinar-app \
    &amp;&amp; curl https://gradle-initializr.cleverapps.io/starter.zip \
    -d type=kotlin-application \
    -d dsl=kotlin \
    -d projectName=webinar-app \
    -d gradleVersion=5.3.1 \
    -o webinar-app.zip \
    &amp;&amp; unzip -o webinar-app.zip \
    &amp;&amp; rm webinar-app.zip</code></pre></section><section id="anatomy-of-the-build"><h2>Anatomy of the build</h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── settings.gradle.kts
├── build.gradle.kts
├── gradlew
├── gradlew.bat
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
└── src
    ├── main
    │   └── kotlin
    │       └── *
    └── test
        └── kotlin
            └── *</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>In both cases the output is the same</p></li><li><p>the first thing to notice is the .kts script file extension</p></li><li><p>KTS stands for KoTlin Script</p></li><li><p>and that&#8217;s how you opt-in to the Gradle Kotlin DSL</p></li></ul></div></aside></section><section id="the-settings-script"><h2>The settings script</h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── settings.gradle.kts                 ⬅
├── build.gradle.kts
├── gradlew
├── gradlew.bat
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
└── src
    ├── main
    │   └── kotlin
    │       └── *
    └── test
        └── kotlin
            └── *</code></pre></section><section id="code-settings-gradle-kts-code"><h2><code>settings.gradle.kts</code></h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">rootProject.name = "webinar-app"</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>controls the settings for the whole build</p></li><li><p>the most common thing to control is the project structure</p></li><li><p>other global build configurations such as build cache, where to find plugins, etc</p></li></ul></div></aside></section><section id="the-root-project-build-script"><h2>The root project build script</h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── settings.gradle.kts
├── build.gradle.kts                    ⬅
├── gradlew
├── gradlew.bat
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
└── src
    ├── main
    │   └── kotlin
    │       └── *
    └── test
        └── kotlin
            └── *</code></pre></section><section id="code-build-gradle-kts-code"><h2><code>build.gradle.kts</code></h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.21"
    application
}
repositories {
    jcenter()
}
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testImplementation("org.jetbrains.kotlin:kotlin-test")
    testImplementation("org.jetbrains.kotlin:kotlin-test-junit")
}
application {
    mainClassName = "webinar.app.AppKt"
}</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>the root project build script</p></li><li><p>we say <code>root</code> because in fact you could have many, in this case we have just one</p></li><li><p>it configures a Kotlin JVM application</p></li><li><p>sets up the repository where to find the dependencies</p></li><li><p>sets up the dependencies, if you want to know more about this important topic see the Dependency Management Fundamentals webinar</p></li><li><p>sets up the application entry point</p></li></ul></div></aside></section><section id="the-gradle-wrapper"><h2>The Gradle wrapper</h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── settings.gradle.kts
├── build.gradle.kts
├── gradlew                             ⬅
├── gradlew.bat                         ⬅
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar          ⬅
│       └── gradle-wrapper.properties   ⬅
└── src
    ├── main
    │   └── kotlin
    │       └── *
    └── test
        └── kotlin
            └── *</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>the Gradle wrapper is a way for a build to declare/specify the version of Gradle it uses</p></li><li><p>the script will automatically download the declared Gradle distribution</p></li><li><p>makes it easy to get the build up and running (either in CI or some other developer&#8217;s machine)</p></li><li><p>only requires a JVM to bootstrap the whole build</p></li></ul></div></aside></section><section id="the-project-sources"><h2>The project sources</h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── settings.gradle.kts
├── build.gradle.kts
├── gradlew
├── gradlew.bat
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
└── src
    ├── main
    │   └── kotlin
    │       └── *                       ⬅
    └── test
        └── kotlin
            └── *                       ⬅</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>and as you might expect, the source code for the application and tests in the standard layout</p></li></ul></div></aside></section><section id="running-the-build"><h2>Running the build</h2><div class="paragraph"><p><strong>From the command line</strong></p></div>
<div class="paragraph"><p><strong>DEMO</strong></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>command line first</p></li><li><p>and here we just use the Gradle wrapper to execute the <code>run</code> task provided by the <code>application</code> plugin</p></li></ul></div></aside></section><section id="working-with-the-build"><h2>Working with the build</h2><div class="paragraph"><p><strong>Using an IDE</strong></p></div>
<div class="paragraph"><p><strong>DEMO</strong></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>POLL about IDE</p></li><li><p>show importing the build in an IDE</p></li><li><p>show run anything</p></li><li><p>mention the Gradle runner is now the default</p></li></ul></div></aside></section></section>
<section><section id="customizing-the-build" data-background-color="#01303a"><h2>Customizing the build</h2></section><section id="code-build-gradle-kts-code-2"><h2><code>build.gradle.kts</code></h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.21"
    application
}
repositories {
    jcenter()
}
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testImplementation("org.jetbrains.kotlin:kotlin-test")
    testImplementation("org.jetbrains.kotlin:kotlin-test-junit")
}
application {
    mainClassName = "webinar.app.AppKt"
}</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>now say we want to change the way our application runs</p></li><li><p>for example, by limiting the amount of memory to only 4MB</p></li><li><p>with the JVM we can achieve that by using the <code>-Xmx</code> command line argument</p></li><li><p>we should be able to tell the <code>application</code> plugin to do just that</p></li><li><p>so let&#8217;s take a closer look at our build script and its <code>application</code> block</p></li><li><p>&gt;&gt; transitions to IDE here with the script already open</p></li><li><p>that&#8217;s what&#8217;s called an extension configuration block</p></li><li><p>in general, extensions are how plugins extend the Gradle DSL</p></li><li><p>in our build, the application plugin is extending the Gradle DSL with the application extension</p></li><li><p>let&#8217;s have a look at the configuration options we have</p><div class="ulist"><ul><li><p>CTRL+SPACE on application block, show docs</p></li></ul></div></li><li><p>let&#8217;s set the jvm args to a listOf("-Xmx4m")</p></li></ul></div></aside></section><section id="configuring-the-code-application-code-plugin"><h2>Configuring the <code>application</code> plugin</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.21"
    application
}
repositories {
    jcenter()
}
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testImplementation("org.jetbrains.kotlin:kotlin-test")
    testImplementation("org.jetbrains.kotlin:kotlin-test-junit")
}
application {
    mainClassName = "webinar.app.AppKt"
    applicationDefaultJvmArgs = listOf("-Xmx4m")
}</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>with our plugin now configured we can run some tasks and see its effect</p></li></ul></div></aside></section><section id="running-the-app-with-the-new-arguments"><h2>Running the app with the new arguments</h2><div class="ulist"><ul><li><p>demo with ./gradlew run -i</p><div class="ulist"><ul><li><p>highligh the new <code>-Xmx4m</code> argument</p></li></ul></div></li><li><p>demo ./gradlew install</p><div class="ulist"><ul><li><p>open script and highlight new argument</p></li></ul></div></li></ul></div></section><section id="configuring-the-kotlin-compiler"><h2>Configuring the Kotlin compiler</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.21"
    application
}
repositories {
    jcenter()
}
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testImplementation("org.jetbrains.kotlin:kotlin-test")
    testImplementation("org.jetbrains.kotlin:kotlin-test-junit")
}
application {
    mainClassName = "webinar.app.AppKt"
    applicationDefaultJvmArgs = listOf("-Xmx4m")
}</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>now, say we want to make sure we never introduce compilation warnings into our code base</p></li><li><p>we can achieve that by configuring the task that runs the Kotlin compiler</p></li><li><p>&gt;&gt; back to the IDE</p><div class="ulist"><ul><li><p>&gt;&gt; add tasks block</p></li><li><p>&gt;&gt; type <code>compile</code> wait for popup</p></li><li><p>&gt;&gt; select <code>compileKotlin {}</code></p></li><li><p>at this point there should be a way to configure the compiler options</p></li><li><p>&gt;&gt; type <code>options</code> wait for popup</p></li><li><p>&gt;&gt; select <code>kotlinOptions {}</code></p></li><li><p>we want to configure how warnings are handled</p></li><li><p>&gt;&gt; type <code>warn</code> wait for popup</p></li><li><p>&gt;&gt; select <code>allWarningsAsErrors</code></p></li><li><p>&gt;&gt; check the docs (^J)</p></li><li><p>&gt;&gt; assign true</p></li><li><p>That should be enough</p></li></ul></div></li></ul></div></aside></section><section id="building-with-the-new-configuration"><h2>Building with the new configuration</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.21"
    application
}
repositories {
    jcenter()
}
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testImplementation("org.jetbrains.kotlin:kotlin-test")
    testImplementation("org.jetbrains.kotlin:kotlin-test-junit")
}
application {
    mainClassName = "webinar.app.AppKt"
    applicationDefaultJvmArgs = listOf("-Xmx4m")
}
tasks {
    compileKotlin {
        kotlinOptions { allWarningsAsErrors = true }
    }
}</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>demo introducing warning by duplicating <code>return "Hello world"</code> line</p><div class="ulist"><ul><li><p>&gt;&gt; navigate to App</p></li><li><p>&gt;&gt; duplicate line</p></li><li><p>&gt;&gt; run anything <code>gradle run</code></p></li><li><p>&gt;&gt; highlight warning output</p></li><li><p>&gt;&gt; fix the code</p></li><li><p>&gt;&gt; run again</p></li></ul></div></li></ul></div></aside></section><section id="what-we-learned-so-far"><h2>What we learned so far</h2><div class="ulist"><ul><li><p>we can change the behavior of the build by</p><div class="ulist"><ul><li><p>configuring extensions and tasks</p></li><li><p>both contributed by plugins</p></li><li><p>in other words, plugins extend the Gradle DSL which can then be configured in scripts like the one we just saw</p></li></ul></div></li></ul></div></section><section id="going-further-modularizing"><h2>Going further: modularizing</h2><div class="paragraph"><p><strong>DEMO</strong></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>split the build into core and app</p><div class="ulist"><ul><li><p><code>apply false</code> in the root project to control the version of the plugin in a single place</p></li><li><p>duplicate <code>compileKotlin</code> configuration logic</p></li></ul></div></li><li><p>dedupe the logic by moving the duplicated compileTask configuration into the root build</p><div class="ulist"><ul><li><p>cross <code>subprojects</code> configuration with <code>val compileKotlin by &#8230;&#8203;</code></p></li></ul></div></li></ul></div></aside></section><section id="what-we-learned-modularizing"><h2>What we learned - modularizing</h2><div class="ulist"><ul><li class="fragment"><p>project evaluation order follows the hierarchy</p></li><li class="fragment"><p>script classpath is inherited</p></li><li class="fragment"><p>cross-configuration requires dynamic references</p></li><li class="fragment"><p>type-safe accessors are not always available</p></li><li class="fragment"><p>see the <em>Kotlin DSL Primer</em> in the User Manual for more information</p></li></ul></div></section><section id="going-further-interoperability"><h2>Going further: interoperability</h2><div class="paragraph"><p><strong>Using non statically typed APIs and DSLs from a statically typed language</strong></p></div>
<div class="paragraph"><p><strong>DEMO</strong></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>introduce company wide Groovy script that validates license headers</p><div class="ulist"><ul><li><p>Groovy script provides extension to configure license (defaults to LGPL)</p></li><li><p><code>app</code> needs to configure script to use GPL</p></li><li><p><code>licensing</code> extension will be untyped because Groovy script type</p></li><li><p>use <code>withGroovyBuilder</code> to set the license (an enum that can be <code>setProperty("license", "GPL")</code> from <code>app</code></p></li></ul></div></li></ul></div></aside></section><section id="what-we-learned-interoperability"><h2>What we learned - interoperability</h2><div class="ulist"><ul><li class="fragment"><p>you can mix Kotlin and Groovy scripts</p></li><li class="fragment"><p>when types are not available, <code>withGroovyBuilder {}</code> to the rescue</p></li><li class="fragment"><p>see the <em>Kotlin DSL Primer</em> in the User Manual for more information</p></li></ul></div></section></section>
<section><section id="organizing-build-logic" data-background-color="#01303a"><h2>Organizing build logic</h2></section><section id="patterns-for-organizing-build-logic"><h2>Patterns for organizing build logic</h2><div class="ulist"><ul><li><p>cross-configuration</p></li><li><p>buildSrc</p></li><li><p>sharing build logic between builds</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>build script logic can get unwieldy with conventions for Kotlin, Java, Scala, Groovy</p></li><li><p>sharing the plugin with a wider audience</p></li></ul></div></aside></section><section id="organizing-build-logic-with-code-buildsrc-code"><h2>Organizing build logic with <code>buildSrc</code></h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── buildSrc
│   ├── build.gradle.kts
│   ├── settings.gradle.kts
│   └── src
│       └── *
├── app
│   ├── build.gradle.kts
│   └── src
│       └── *
├── core
│   ├── build.gradle.kts
│   └── src
│       └── *
├── gradle
│   └── *
├── gradlew.bat
├── gradlew
├── build.gradle.kts
└── settings.gradle.kts</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>extract convention plugin into <code>buildSrc/src/main/kotlin/kotlin-conventions.gradle.kts</code></p><div class="ulist"><ul><li><p>setup <code>buildSrc</code> with <code>kotlin-dsl</code> plugin</p></li><li><p>move <code>kotlin("jvm")</code> plugin dependency to <code>buildSrc</code> / <code>dependencies</code></p></li><li><p>create <code>src/main/kotlin/kotlin-conventions.gradle.kts</code></p></li><li><p>plugins block with <code>kotlin("jvm")</code> plugin</p></li><li><p>move <code>compileKotlin</code> configuration into <code>kotlin-conventions</code></p></li><li><p>simplify script plugin with type-safe accessor</p></li><li><p><code>subprojects { apply(plugin = "kotlin-conventions") }</code> in root</p></li><li><p>demonstrate introducing warning and failing the build still works</p><div class="ulist"><ul><li><p>quick demo testing buildSrc</p></li></ul></div></li></ul></div></li></ul></div></aside></section><section id="what-we-learned"><h2>What we learned</h2><div class="ulist"><ul><li class="fragment"><p><code>buildSrc</code> is the conventional build for build logic</p></li><li class="fragment"><p>the <code>kotlin-dsl</code> plugin brings the Gradle Kotlin DSL support to Kotlin source sets</p></li><li class="fragment"><p>Gradle Kotlin DSL scripts in Kotlin source sets are exposed as Gradle plugins</p></li><li class="fragment"><p>see the <em>Kotlin DSL Primer</em> in the User Manual for more information</p></li></ul></div></section><section id="sharing-build-logic-between-builds"><h2>Sharing build logic between builds</h2><pre class="highlight listingblock"><code data-noescape="" class="text language-text">.
├── build-logic
│   ├── build.gradle.kts
│   ├── settings.gradle.kts
│   └── src
│       └── *
└── webinar-app
    ├── app
    │   ├── build.gradle.kts
    │   └── src
    │       └── *
    ├── core
    │   ├── build.gradle.kts
    │   └── src
    │       └── *
    ├── gradle
    │   └── *
    ├── gradlew
    ├── gradlew.bat
    ├── build.gradle.kts
    └── settings.gradle.kts</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>extract plugin to separate build</p></li><li><p>freeze the project name in settings.gradle.kts</p></li><li><p>add group and version to <code>build.gradle.kts</code></p></li><li><p>to consume the plugin</p><div class="ulist"><ul><li><p>include build</p></li><li><p>set up <code>gradle.rootProject.buildscript</code> classpath (dependencies and repositories)</p></li></ul></div></li></ul></div></aside></section></section>
<section><section id="authoring-plugins" data-background-color="#01303a"><h2>Authoring plugins</h2></section><section id="authoring-plugins-2"><h2>Authoring plugins</h2><div class="paragraph"><p><strong>Sharing plugins with a wider audience</strong></p></div>
<div class="ulist"><ul><li class="fragment"><p>Publishing plugins</p></li><li class="fragment"><p>DSLs that play well with both Kotlin, Groovy and other JVM languages</p></li><li class="fragment"><p>Plugins that can be used across Gradle versions</p></li></ul></div></section><section id="publishing-plugins"><h2>Publishing plugins</h2><div class="ulist"><ul><li class="fragment"><p>To the Gradle Plugin Portal or an internal repository</p></li><li class="fragment"><p>Well covered in the <em>Plugin Development</em> guides</p></li><li class="fragment"><p>Doesn&#8217;t prevent the included build workflow</p></li><li class="fragment"><p>Which is orthogonal to choosing mono-repo vs. multi-repo</p></li></ul></div></section><section id="dsls-that-play-well-with-jvm-languages"><h2>DSLs that play well with JVM languages</h2><div class="ulist"><ul><li class="fragment"><p>Diverse build script DSLs languages - Kotlin, Groovy</p></li><li class="fragment"><p>Diverse plugin implementation languages - any JVM language</p></li><li class="fragment"><p>Common denominator is <strong>static typing</strong></p></li><li class="fragment"><p>Applicable to every JVM language</p></li><li class="fragment"><p><strong>It&#8217;s always easier to use statically typed APIs from dynamically typed languages than the other way around</strong></p></li></ul></div></section><section id="dsls-that-play-well-with-jvm-languages-2"><h2>DSLs that play well with JVM languages</h2><div class="paragraph"><p><strong>Prefer exposing statically typed APIs over dynamically or unityped APIs</strong></p></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">enum class MyOption { NONE, FEW, LOTS, ALL }

// The good 👍
interface MyDslType {

    fun doSomethingOn(option: MyOption)

    // Optionally
    fun doSomethingOn(option: String) =
        doSomethingOn(MyOption.valueOf(option.toUpperCase()))
}

// The bad 👎
interface MyDslType {
    fun doSomethingOn(option: Any)
}</code></pre></section><section id="dsls-that-play-well-with-jvm-languages-3"><h2>DSLs that play well with JVM languages</h2><div class="paragraph"><p><strong>Prefer Gradle types over language specific types</strong></p></div>
<pre class="highlight listingblock"><code data-noescape="" class="java language-java">interface MyDslType {
    // The good 👍
    void doThis(org.gradle.api.Action&lt;Type&gt; block);
}</code></pre>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">interface MyDslType {
    // The bad 👎
    fun doThis(block: Typed.() -&gt; Unit)
}</code></pre>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">interface MyDslType {
    // The ugly 👹
    def doThis(groovy.lang.Closure block)
}</code></pre>
<aside class="notes"><div class="ulist"><ul><li><p>prefer Gradle types over language specific types</p><div class="ulist"><ul><li><p>e.g. org.gradle.api.Action&lt;T&gt; over groovy.lang.Closure or kotlin.Function</p></li><li><p>&gt;&gt; show 3 snippets: good, kotlin bad, groovy ugly</p></li></ul></div></li></ul></div></aside></section><section id="plugins-that-can-be-used-across-gradle-versions"><h2>Plugins that can be used across Gradle versions</h2><div class="paragraph"><p><strong>Always start with / aim for the latest Gradle version</strong></p></div>
<div class="ulist"><ul><li class="fragment"><p>In order to take advantage of all the goodness</p></li><li class="fragment"><p>Apply best practices (see the <em>Plugin Development</em> guides)</p></li><li class="fragment"><p>Do cross-version testing</p></li><li class="fragment"><p>Can be as simple as JUnit parameterized tests driving TestKit</p></li></ul></div></section><section id="plugins-that-can-be-used-across-gradle-versions-2"><h2>Plugins that can be used across Gradle versions</h2><div class="paragraph"><p><strong>Cross-version testing with JUnit</strong></p></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">abstract class AbstractPluginTest(val gradleVersion: String) {
    companion object {
        @Parameterized.Parameters(name = "Gradle {0}")
        @JvmStatic
        fun testedGradleVersions() = listOf("5.3.1", ...., "4.7")   ⬅
    }

    fun gradleRunnerFor(vararg arguments: String) =
        GradleRunner.create()
            .withGradleVersion(gradleVersion)                       ⬅
            .withPluginClasspath()
            .withProjectDir(rootDir)
            .withArguments(*arguments)
}</code></pre></section><section id="plugins-that-can-be-used-across-gradle-versions-3"><h2>Plugins that can be used across Gradle versions</h2><div class="paragraph"><p><strong>Incrementally support Gradle versions</strong></p></div>
<div class="ulist"><ul><li class="fragment"><p>Add Gradle version to the test matrix</p></li><li class="fragment"><p>Fix as needed (see the <em>Upgrading Gradle</em> section of the User Manual)</p></li><li class="fragment"><p>Repeat</p></li><li class="fragment"><p>Stop when satisfied or overwhelmed</p></li></ul></div></section><section id="plugins-that-can-be-used-across-gradle-versions-4"><h2>Plugins that can be used across Gradle versions</h2><div class="paragraph"><p><strong>Supporting multiple Gradle versions</strong></p></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">val myTaskConfiguration: MyTask.() -&gt; Unit = {
    // ...
}
if (GradleVersion.current() &gt;= GradleVersion.version("4.9")) {
    // Support lazy task registration
    val myTask = tasks.register("my", MyTask::class.java, myTaskConfiguration)
    // ...
} else {
    // Eager task creation
    val myTask = tasks.create("my", MyTask::class.java, myTaskConfiguration)
    // ...
}</code></pre></section></section>
<section><section id="wrap-up" data-background-color="#01303a"><h2>Wrap up</h2></section><section id="what-we-learned-2"><h2>What we learned</h2><div class="ulist"><ul><li class="fragment"><p>Creating a Gradle Kotlin DSL build with or without Gradle installed</p></li><li class="fragment"><p>Customizing builds</p><div class="ulist"><ul><li class="fragment"><p>by configuring extensions and tasks contributed by plugins</p></li><li class="fragment"><p>by mixing Kotlin and Groovy build logic</p></li><li class="fragment"><p>by modularizing into projects</p></li></ul></div></li><li class="fragment"><p>Organizing build logic using cross-configuration, <code>buildSrc</code> and shared plugins</p></li><li class="fragment"><p>Authoring plugins and DSLs</p><div class="ulist"><ul><li class="fragment"><p>that play well with different DSLs and JVM languages</p></li><li class="fragment"><p>that support multiple Gradle versions</p></li></ul></div></li></ul></div></section><section id="documentation-links"><h2>Documentation links</h2><div class="ulist"><ul><li><p><a href="https://gradle.github.io/webinar-getting-started-with-the-gradle-kotlin-dsl">This webinar slides</a></p></li><li><p><a href="https://github.com/gradle/webinar-getting-started-with-the-gradle-kotlin-dsl/tree/master/webinar-app">This webinar sample builds</a></p></li><li><p><a href="https://github.com/gradle/webinar-getting-started-with-the-gradle-kotlin-dsl">This webinar source</a></p></li><li><p><a href="https://docs.gradle.org/current/userguide/kotlin_dsl.html">Kotlin DSL Primer</a></p></li><li><p><a href="https://guides.gradle.org/migrating-build-logic-from-groovy-to-kotlin/">Kotlin DSL Migration Guide</a></p></li><li><p><a href="https://docs.gradle.org/current/userguide/userguide.html">Gradle User Manual</a></p></li><li><p><a href="https://gradle.org/guides/?q=Plugin%20Development">Plugin development tutorials</a></p></li><li><p><a href="https://gradle.com/blog/dependency-management-with-gradle-fundamentals/">Dependency Management with Gradle Part 1 – Fundamentals</a></p></li></ul></div></section></section>
<section id="questions" data-background-color="#01303a"><h2>Questions?</h2><aside class="notes"><div class="ulist"><ul><li><p>Upgrade Kotlin DSL version without upgrading Gradle?</p><div class="ulist"><ul><li><p>NO</p></li></ul></div></li><li><p>Distinguish build-logic and production Kotlin version</p><div class="ulist"><ul><li><p>build-logic: let Gradle handle the Kotlin version by using either the <code>kotlin-dsl</code> or <code>embedded-kotlin</code> plugin</p></li><li><p>production code: business as usual</p></li></ul></div></li><li><p>Dependency Management</p><div class="ulist"><ul><li><p>You should refer to the Dependency Management documentation, webinar (they are using the Kotlin DSL)</p></li><li><p>There&#8217;s nothing special about the Kotlin DSL from a dependency management pov</p></li></ul></div></li></ul></div></aside></section>
<section id="thank-you" data-background-color="#01303a"><h2>Thank you!</h2></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'fade',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script><!-- this currently shows up at the wrong location in the final index.html which means the style font is not properly applied-->

<div class="footer">
</div></body></html>